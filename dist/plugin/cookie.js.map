{"version":3,"sources":["plugin/cookie.js"],"names":["document","provide","path","iterate","isObject","isTypeOf","enabled","past","pattern","setCookie","dependency","value","expiration","pointer","match","i","indexOf","weight","state","isEnabled","cookie","type","encodeURIComponent","demand","on","options","length","key","push","JSON","stringify"],"mappings":";CAAA,SAAUA,GACN,aA8CAC,SAAS,OAAQ,2BAA4B,6BAA8B,8BA5C3E,SAAoBC,EAAMC,EAASC,EAAUC,GACzC,IAGIC,EAHAC,EAAO,gCAEPC,KAuBJ,SAASC,EAAUC,EAAYC,EAAOC,IAC9BN,GAKR,SAAmBJ,GAGf,IAFA,IACIW,EAASC,EADTC,EAAI,EAEDF,EAAUL,EAAQO,GAAIA,IACa,IAAlCb,EAAKc,QAAQH,EAAQL,YAAoBM,GAASD,EAAQI,OAASH,EAAMG,UACzEH,EAAQD,GAGhB,QAAOC,GAAQA,EAAMI,MAbNC,CAAUT,EAAWR,SAChCF,EAASoB,OAAS,UAAYV,EAAWW,KAAO,KAAOX,EAAWR,KAAO,KAAOoB,mBAAmBX,GAAS,aAAeC,EAAa,YAchJ,OArCAW,OAAOC,GAAG,iBAAmBtB,EAAM,SAASuB,GACpCrB,EAASqB,IACTjB,EAAQkB,OAAS,EACjBvB,EAAQsB,EAAS,SAASE,EAAKhB,GAC3BH,EAAQoB,MACJpB,QAASmB,EACTV,OAAQU,EAAID,OACZR,MAAOP,OAGRN,EAASoB,EAAS,aACzBnB,EAAUmB,KAEfD,GAAG,YAAa,SAASd,GACxBD,EAAUC,EAAY,GAAIH,KAC3BiB,GAAG,aAAc,SAASd,GACzBD,EAAUC,EAAY,GAAIH,KAC3BiB,GAAG,YAAa,SAASd,EAAYQ,GACpCT,EAAUC,EAAYmB,KAAKC,UAAUZ,GArB5B,oCAwCN,IA7Cf,CAgDGlB","file":"cookie.js","sourcesContent":["(function(document) {\n    \"use strict\";\n\n    function definition(path, iterate, isObject, isTypeOf) {\n        var past = \"Thu, 01 Jan 1970 00:00:00 GMT\",\n            future = \"Fri, 31 Dec 9999 23:59:59 GMT\",\n            pattern = [],\n            enabled;\n        demand.on(\"postConfigure:\" + path, function(options) {\n            if (isObject(options)) {\n                pattern.length = 0;\n                iterate(options, function(key, value) {\n                    pattern.push({\n                        pattern: key,\n                        weight: key.length,\n                        state: value\n                    })\n                })\n            } else if (isTypeOf(options, \"boolean\")) {\n                enabled = options\n            }\n        }).on(\"cacheMiss\", function(dependency) {\n            setCookie(dependency, \"\", past)\n        }).on(\"cacheClear\", function(dependency) {\n            setCookie(dependency, \"\", past)\n        }).on(\"postCache\", function(dependency, state) {\n            setCookie(dependency, JSON.stringify(state), future)\n        });\n\n        function setCookie(dependency, value, expiration) {\n            if (enabled || isEnabled(dependency.path)) {\n                document.cookie = \"demand[\" + dependency.type + \"][\" + dependency.path + \"]=\" + encodeURIComponent(value) + \"; expires=\" + expiration + \"; path=/\"\n            }\n        }\n\n        function isEnabled(path) {\n            var i = 0,\n                pointer, match;\n            for (; pointer = pattern[i]; i++) {\n                if (path.indexOf(pointer.pattern) === 0 && (!match || pointer.weight > match.weight)) {\n                    match = pointer\n                }\n            }\n            return match ? match.state : false\n        }\n        return true\n    }\n    provide([\"path\", \"/demand/function/iterate\", \"/demand/validator/isObject\", \"/demand/validator/isTypeOf\"], definition)\n})(document);"]}