{"version":3,"sources":["plugin/cookie.js"],"names":["document","provide","path","iterate","isObject","isTypeOf","enabled","past","pattern","setCookie","dependency","value","expiration","pointer","match","i","indexOf","weight","state","isEnabled","cookie","type","encodeURIComponent","demand","on","options","length","key","push","JSON","stringify"],"mappings":";CAAC,SAASA,GACT,aAmDAC,SAAU,OAAQ,2BAA4B,6BAA8B,8BAjD5E,SAAoBC,EAAMC,EAASC,EAAUC,GAC5C,IAGCC,EAHGC,EAAU,gCAEbC,KAyBD,SAASC,EAAUC,EAAYC,EAAOC,IAClCN,GAKJ,SAAmBJ,GAGlB,IAFA,IAAWW,EAASC,EAAhBC,EAAI,EAEDF,EAAUL,EAAQO,GAAKA,IACQ,IAAlCb,EAAKc,QAAQH,EAAQL,YAAoBM,GAASD,EAAQI,OAASH,EAAMG,UAC3EH,EAAQD,GAIV,QAAOC,GAAQA,EAAMI,MAdPC,CAAUT,EAAWR,SAClCF,EAASoB,OAAS,UAAYV,EAAWW,KAAO,KAAOX,EAAWR,KAAO,KAAOoB,mBAAmBX,GAAS,aAAeC,EAAa,YAgB1I,OAxCAW,OACCC,GAAG,iBAAmBtB,EAAM,SAASuB,GACjCrB,EAASqB,IACXjB,EAAQkB,OAAS,EAEjBvB,EAAQsB,EAAS,SAASE,EAAKhB,GAC9BH,EAAQoB,MAAOpB,QAASmB,EAAKV,OAAQU,EAAID,OAAQR,MAAOP,OAEhDN,EAASoB,EAAS,aAC3BnB,EAAUmB,KAGXD,GAAG,YAAa,SAASd,GACzBD,EAAUC,EAAY,GAAIH,KAE1BiB,GAAG,aAAc,SAASd,GAC1BD,EAAUC,EAAY,GAAIH,KAE1BiB,GAAG,YAAa,SAASd,EAAYQ,GACrCT,EAAUC,EAAYmB,KAAKC,UAAUZ,GAvB5B,oCA4CJ,IAjDT,CAqDElB","file":"cookie.js","sourcesContent":["(function(document) {\n\t'use strict';\n\n\tfunction definition(path, iterate, isObject, isTypeOf) {\n\t\tvar past    = 'Thu, 01 Jan 1970 00:00:00 GMT',\n\t\t\tfuture  = 'Fri, 31 Dec 9999 23:59:59 GMT',\n\t\t\tpattern = [],\n\t\t\tenabled;\n\t\t\n\t\tdemand.\n\t\t\ton('postConfigure:' + path, function(options) {\n\t\t\t\tif(isObject(options)) {\n\t\t\t\t\tpattern.length = 0;\n\n\t\t\t\t\titerate(options, function(key, value) {\n\t\t\t\t\t\tpattern.push({ pattern: key, weight: key.length, state: value });\n\t\t\t\t\t});\n\t\t\t\t} else if(isTypeOf(options, 'boolean')) {\n\t\t\t\t\tenabled = options;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('cacheMiss', function(dependency) {\n\t\t\t\tsetCookie(dependency, '', past);\n\t\t\t})\n\t\t\t.on('cacheClear', function(dependency) {\n\t\t\t\tsetCookie(dependency, '', past);\n\t\t\t})\n\t\t\t.on('postCache', function(dependency, state) {\n\t\t\t\tsetCookie(dependency, JSON.stringify(state), future);\n\t\t\t});\n\n\t\tfunction setCookie(dependency, value, expiration) {\n\t\t\tif(enabled || isEnabled(dependency.path)) {\n\t\t\t\tdocument.cookie = 'demand[' + dependency.type + '][' + dependency.path + ']=' + encodeURIComponent(value) + '; expires=' + expiration + '; path=/';\n\t\t\t}\n\t\t}\n\n\t\tfunction isEnabled(path) {\n\t\t\tvar i = 0, pointer, match;\n\n\t\t\tfor(; (pointer = pattern[i]); i++) {\n\t\t\t\tif(path.indexOf(pointer.pattern) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\tmatch = pointer;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn match ? match.state : false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprovide([ 'path', '/demand/function/iterate', '/demand/validator/isObject', '/demand/validator/isTypeOf' ], definition);\n}(document));"]}