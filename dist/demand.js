/**! Qoopido.demand 6.1.2 | https://github.com/dlueth/qoopido.demand | (c) 2020 Dirk Lueth */
!function(e,t,n){"use strict";var r,i,o,u,a=e.document,s="demand"in e&&e.demand,c={version:"1.0.0",cache:{},timeout:8e3,pattern:{},modules:{},handler:"module"},d=Array.prototype,f=d.slice,l=d.concat,h=Object,p=h.create,v=h.defineProperty,m=h.getOwnPropertyNames,g=h.getOwnPropertyDescriptor,y=a.createElement("a");function w(e,t,n,r){return{__proto__:null,value:e,enumerable:!!r,configurable:!!n,writable:!!t}}function x(e,t){return typeof e===t}function b(e){return e&&x(e,"object")}function j(e){return x(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function q(e,t){return e instanceof t}!function(t){function n(e,t,n,r,i){v(this,e,new w(t,n,r,i))}function r(e){for(var t,n=this.prototype,r=m(n),i={constructor:new w(this,!0,!0)},o=0;(t=r[o])&&!i[t];o++)i[t]=g(n,t);try{this.prototype=p(e.prototype||e,i)}catch(e){}if(this.prototype===n)throw new TypeError("Unable to extend, prototype is not writable");return this}n.call(Object.prototype,"defineProperty",n),n.call(e.Object.prototype,"defineProperty",n),Function.prototype.defineProperty("extends",r),e.Function.prototype.defineProperty("extends",r)}();var k,R=(k=/^\bv?(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)(?:-[\da-z-]+(?:\.[\da-z-]+)*)?(?:\+[\da-z-]+(?:\.[\da-z-]+)*)?\b$/i,function(e){return x(e,"string")&&k.test(e)});function P(e,t,n){for(var r,i=h.keys(e),o=0;void 0!==(r=i[o])&&!1!==t.call(n,r,e[r]);o++);return n}var E,M,C=function(){function e(e,t){var n,r=this[e];void 0!==t&&(b(t)?(n=b(r),r=void 0!==t.length?n&&void 0!==r.length?r:[]:n&&void 0===r.length?r:{},this[e]=C(r,t)):this[e]=t)}return function(){for(var t,n=arguments[0],r=1;void 0!==(t=arguments[r]);r++)P(t,e,n);return n}}(),S=function(){var e=new RegExp("[xy]","g");function t(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t)}}(),T="setImmediate"in e&&"function"==typeof e.setImmediate?e.setImmediate:"MutationObserver"in e&&"function"==typeof e.MutationObserver?(E={},M=a.createElement("div"),new MutationObserver((function(e){e.forEach((function(e){var t=e.attributeName.substr(1);E[t]&&E[t](),delete E[t]}))})).observe(M,{attributes:!0}),function(e){var t=S();E[t]=e,M.setAttribute("i"+t,1)}):t;function A(e,t,n){return f.call(e,t,n)}var O=function(){var e=/^cache(Miss|Hit|Clear|Exceed)|queue(En|De)queue|(pre|post)(Resolve|Configure|Request|Process|Cache)|provide|reject$/,t={};function n(n,r,i){var o,u;if(x(r,"string")&&x(i,"function"))for(r=r.split(" ");o=r.shift();)o=o.split(":"),e.test(o[0])&&((t[o[0]]||(t[o[0]]={on:[],after:[]}))[n].push({callback:i,filter:o[1]}),"on"===n&&"postConfigure"===o[0]&&(u=c.modules[o[1]])&&i(u))}function r(){}return r.prototype={emit:function(e,n){var r,i,o,u=t[e];if(u){for(r=A(arguments,2),i=0;o=u.on[i];i++)o.filter&&o.filter!==n||o.callback.apply(null,r);for(i=0;o=u.after[i];i++)o.filter&&o.filter!==n||o.callback.apply(null,r)}return this},on:function(e,t){return n("on",e,t),this},after:function(e,t){return n("after",e,t),this}},new r}(),$="WeakMap"in e&&!("ActiveXObject"in e)?e.WeakMap:function(){function e(e,t){var n;if((n=t[e.id])&&n[0]===t)return n}function t(){this.defineProperty("id","weakmap-"+S())}return t.prototype={set:function(t,n){var r=e(this,t);return r?r[1]=n:t.defineProperty(this.id,[t,n]),this},get:function(t){var n=e(this,t);if(n)return n[1]},delete:function(t){var n=e(this,t);n&&(n.length=0,delete t[this.id])},has:function(t){return!!e(this,t)}},t}();function I(){return x(this.uuid,"undefined")&&this.defineProperty("uuid",S()),this}var H=function(){var e=new $;function t(){var t=I.call(this);return e.set(t,[]),t}return t.prototype={enqueue:function(){var t=A(arguments);e.set(this,e.get(this).concat(t)),O.emit("queueEnqueue",this.uuid,t)},dequeue:function(){var t=e.get(this).shift();return O.emit("queueDequeue",this.uuid,t),t},get current(){return e.get(this)[0]},get length(){return e.get(this).length}},t.extends(I)}(),N=function(){var r,i="object"==typeof e.safari&&e.safari.pushNotification?"beforeunload":"visibilitychange",o=e.requestIdleCallback||function(e,n){var r=+new Date;return t((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(+new Date-r))}})}),n&&n.timeout)},u=e.cancelIdleCallback||function(e){n(e)},s=new H;function c(){s.dequeue()(),r=s.length&&o(c)}return e.addEventListener(i,(function(e){var t;if(s.length&&("visibilitychange"!==e.type||"hidden"===a.visibilityState)){r=u(r);do{t&&t()}while(t=s.dequeue())}}),!0),function(e,t){s.enqueue(e),!r&&s.length&&(r=o(c,{timeout:t}))}}();function D(){return+new Date}function L(e){return y.href=e,y.href}var B=/^(http(s?):)?\/\//i,U=/^\/|@/,z=/((?:\/\/|\/\*)#)\s*(sourceMappingURL)\s*=\s*(?!(?:http[s]?:)?\/\/)(.+?)\.map(?:\s+)?(\*\/)?/g,_=/\.\w+$/,F=new RegExp("^"+L("/")),W=new RegExp("^demand|provide|path|exports$"),X=/^(mock:)?([+-])?((?:[-\w]+\/?)+)?(?:@(.+?))?(?:#(\d+))?!/;function G(e,t){var n=e.replace(X,"");return U.test(n)||B.test(n)||(n="/"+L((t&&L(t+"/../")||"/")+n).replace(F,"")),n}function J(e,t){var n=e.match(X);return(n&&n[1]?"mock:":"")+(n&&n[3]||c.handler)+"!"+G(e,t)}var K=function(){function e(e,t){return e<t?-1:e>t?1:0}function t(e){if(!R(e))throw new TypeError('"version" must be a valid semver version string');e=function(e){var t,n=e.split("-"),r=0;for(n=n[1]?Array.prototype.concat(n[0].split("."),n[1].split(".")):n[0].split(".");t=n[r];r++)n[r]=parseInt(t,10).toString()===t?parseInt(t,10):t;return n}(e),this.major=e.shift(),this.minor=e.shift(),this.patch=e.shift(),this.identifier=e}return t.prototype={toString:function(){return this.major+"."+this.minor+"."+this.patch+(this.identifier.length?"-"+this.identifier.join("."):"")},compare:function(t){return e(this.major,t.major)||e(this.minor,t.minor)||e(this.patch,t.patch)||function(e,t){var n,r,i,o,u=0;if(e.length&&!t.length)return-1;if(!e.length&&t.length)return 1;if(!e.length&&!t.length)return 0;do{if(n=e[u],o=typeof(r=t[u]),"undefined"==(i=typeof n)&&"undefined"===o)return 0;if("undefined"===o)return 1;if("undefined"===i)return-1;if(n===r);else{if("string"===i&&"string"!==o)return 1;if("string"!==i&&"string"===o)return-1;if(n>r)return 1;if(n<r)return-1}}while(++u)}(this.identifier,t.identifier)}},t}(),Q=function(){var t,n=new RegExp("^[demand]\\[(.+?)\\][state]$"),i=/^(.+?),(\d+),(\d*),(.+?),(\d+)$/,o=function(){try{return"localStorage"in e&&e.localStorage}catch(e){return!1}}(),u=o?e.localStorage:null,a=o&&"remainingSpace"in u,s={};function d(e){var t;return null!==e.cache?e.cache:(P(c.cache,(function(n,r){0===e.path.indexOf(n)&&(!t||r.weight>t.weight)&&(t=r)})),!!t&&t.state)}function f(e){return u.getItem(e)}function l(e,t){u[t?"setItem":"removeItem"](e,t)}function h(e){var t,n=f(e);if(n&&(t=n.match(i)))return A(t,1)}function p(e,t){t[4]=D(),l(e,t.join(","))}function v(e,t,n){O.emit(e,t.id,t,n)}function m(){N(this.clear.expired.bind(this.clear),c.delay)}return O.on("cacheMiss",(function(e){N((function(){t.clear(e.id)}))})).on("cacheExceed",(function(e){r("-!/demand/cache/dispose").then((function(n){N((function(){n(e.source.length),t.set(e)}),c.delay)}))})).on("postRequest",(function(e){e.source&&d(e)&&(s[e.id]=!0)})).after("postProcess",(function(e){s[e.id]&&N((function(){t.set(e)}),c.delay)})),m.prototype={get:o?function(e){var t,n;if(d(e)){if(t="[demand]["+e.id+"]",!(n=h(t+"[state]")))return;return 1===e.version.compare(new K(n[0]))||n[2]&&e.lifetime&&n[2]<=D()?void(e.invalid=!0):(e.source=f(t+"[value]"),N((function(){p(t+"[state]",n)}),c.delay),!0)}}:function(){},resolve:o?function(e){this.get(e)?v("cacheHit",e):v("cacheMiss",e)}:function(e){v("cacheMiss",e)},set:o?function(e){var t,n,i;if(d(e)){t=[e.version,e.source.length,e.lifetime?D()+e.lifetime:null,r.version],n="[demand]["+e.id+"]",v("preCache",e,t);try{if(i=a?u.remainingSpace:null,l(n+"[value]",e.source),p(n+"[state]",t),null!==i&&u.remainingSpace===i)throw new Error;v("postCache",e,t)}catch(t){v("cacheExceed",e)}}}:function(){},clear:o?function(e){var t=J(e),n="[demand]["+t+"]";f(n+"[state]")&&(l(n+"[state]"),l(n+"[value]"),v("cacheClear",ne.get(t)||new ne(t,null,!1)))}:function(){}},m.prototype.clear.all=o?function(){var e;P(u,(function(t){(e=t.match(n))&&this(e[1])}),this)}:function(){},m.prototype.clear.expired=o?function(){var e,t;P(u,(function(r){(e=r.match(n))&&(t=h("[demand]["+e[1]+"][state]"))&&t[2]>0&&t[2]<=D()&&this(e[1])}),this)}:function(){},t=new m}();function V(e,t,n){return this.message=e,t&&(this.module=t),n&&(this.stack=A(n)),this}V.prototype={toString:function(){var e=this.message+" "+(this.module?'"'+this.module+'"':"");return this.stack&&(e=V.traverse(this.stack,e,1)),e}},V.traverse=function(e,t,n){for(var r,i=new Array(n+1).join(" "),o=0;r=e[o];o++)t+="\n"+i+"> "+r.message+" "+(r.module?'"'+r.module+'"':""),r.stack&&(t=V.traverse(r.stack,t,n+1));return t};var Y,Z,ee=function(){var e=new $;function t(){var t=this,n=arguments;T((function(){e.get(t).handle("resolved",n)}))}function n(){var t=this,n=arguments;T((function(){e.get(t).handle("rejected",n)}))}function r(t,n){var r,i,o=e.get(this);for("pending"===o.state&&(o.state=t,o.value=n,"rejected"!==t||o[t].length||function(e){var t,n=0;for(console.warn("unhandled pledge rejection");void 0!==(t=e[n]);n++)if(q(t,Error)||q(t,V))throw t}(n));r=o[o.state].shift();)try{if(q(i=r.handler.apply(null,o.value),u)){i.then(r.dfd.resolve,r.dfd.reject);continue}if("resolved"===o.state&&x(i,"undefined")){r.dfd.resolve.apply(null,o.value);continue}r.dfd.resolve(i)}catch(e){r.dfd.reject(e)}o.resolved.length=0,o.rejected.length=0}function i(e,t,n){e.then((function(){n.resolved[t]=A(arguments),n.count++,o(n)}),(function(){n.rejected.push(A(arguments)),o(n)}))}function o(e){e.count===e.total?e.dfd.resolve.apply(null,l.apply([],e.resolved)):e.rejected.length+e.count===e.total&&e.dfd.reject.apply(null,l.apply([],e.rejected))}function u(i){return e.set(this,{state:"pending",handle:r.bind(this),value:null,resolved:[],rejected:[],count:0}),i(t.bind(this),n.bind(this)),this}return u.prototype={isPending:function(){return"pending"===e.get(this).state},isResolved:function(){return"resolved"===e.get(this).state},isRejected:function(){return"rejected"===e.get(this).state},then:function(t,n){var r=e.get(this),i=u.defer();return r.resolved.push({handler:t||u.resolve,dfd:i}),r.rejected.push({handler:n||u.reject,dfd:i}),"pending"!==r.state&&T(r.handle),i.pledge},catch:function(e){return this.then(void 0,e)},always:function(e){return this.then(e,e)}},u.prototype.finally=u.prototype.always,u.defer=function(){var e={};return e.pledge=new u((function(t,n){e.resolve=t,e.reject=n})),e},u.all=function(e){var t,n,r=u.defer(),o=0;if(e.length)for(t={dfd:r,resolved:[],rejected:[],total:e.length,count:0};n=e[o];o++)i(n,o,t);else r.resolve();return r.pledge},u.race=function(e){for(var t,n=u.defer(),r=0;t=e[r];r++)t.then(n.resolve,n.reject);return e.length||n.resolve(),n.pledge},u.resolve=function(){var e=u.defer();return e.resolve.apply(null,arguments),e.pledge},u.reject=function(){var e=u.defer();return e.reject.apply(null,arguments),e.pledge},u}(),te=function(){var e=new $;function t(){e.set(this,{})}return t.prototype={get:function(t){return t?e.get(this)[t]:e.get(this)},set:function(t,n){e.get(this)[t]=n},remove:function(t){delete e.get(this)[t]}},t}(),ne=function(){var e=new te,t=/^(?:mock:|internal!)/i,n=[];function o(e,t){this[e]=t}function u(e){t.test(e)||this.push(e)}function s(e,n){!t.test(e)&&n.pledge.isPending()&&this.push(e)}function d(e,n){!t.test(e)&&n.pledge.isResolved()&&this.push(e)}function f(e,n){!t.test(e)&&n.pledge.isRejected()&&this.push(e)}function l(){return P(e.get(),u,[])}function h(t,r,i){var o=this,u=t.match(X)||n;return o.path=G(t,r),o.mock=!!u[1],o.cache=u[2]?"+"===u[1]:null,o.type=u[3]||c.handler,o.version=new K(u[4]||c.version),o.lifetime=u[5]&&1e3*u[5]||c.lifetime,o.id=(o.mock?"mock:":"")+o.type+"!"+o.path,o.uri=(o.mock?"mock:":"")+o.type+"@"+o.version+(j(o.lifetime)&&o.lifetime>0?"#"+o.lifetime:"")+"!"+o.path,o.dfd=ee.defer(),o.pledge=o.dfd.pledge,o.invalid=!1,o.pledge.then((function(){o.value=A(arguments)})),!1!==i&&e.set(o.id,o),o}return l.pending=function(){return P(e.get(),s,[])},l.resolved=function(){return P(e.get(),d,[])},l.rejected=function(){return P(e.get(),f,[])},h.prototype={enqueue:!0},h.get=function(t,n){return e.get(J(t,n))},h.resolve=function(e,t){var n,u=t&&W.test(e),a=u?this.get("internal!"+t+"/"+e):this.get(e,t);if(!a)if(u){switch(a=new h("internal!"+t+"/"+e),e){case"demand":n=P(r,o,r.bind(t));break;case"provide":n=i.bind(t);break;case"path":n=t;break;case"exports":n={},a.dfd.pledge.then(this.get(t).dfd.resolve)}a.dfd.resolve(n)}else a=new h(e,t),r("/demand/handler/"+a.type).then((function(e){a.handler=e,a.mock?a.dfd.resolve(e):Q.resolve(a)}),(function(){a.dfd.reject(new V("error loading (handler)",self.id))}));return a},h.remove=function(t,n,r){var i=J(t,n),o=a.querySelector('[demand-id="'+i+'"]');e.remove(i),e.remove("mock:"+i),o&&o.parentNode.removeChild(o),!1!==r&&Q.clear(i)},h.list=l,h}(),re=function(){var e=/(.+)\/$/;function t(t,n){this[t]={url:L(n).replace(e,"$1"),match:new RegExp("^"+n)}}function n(e,n){this.weight=e.length,this.match=new RegExp("^"+e),this.location=[].concat(n),P(this.location,t,this.location)}return n.prototype={matches:function(e){return this.match.test(e)},process:function(e,t){var n=this.location[t];if(n)return e.replace(this.match,n.url)}},n}(),ie=function(){var e={};function t(e){return e instanceof ArrayBuffer||e instanceof MessagePort||"ImageBitmap"in self&&e instanceof ImageBitmap}return function(n){var r,i;return r="$task = "+n+"; $isTransferable = "+t+"; onmessage = "+function(e){var t,n=Array.prototype.slice,r=e.data;function i(e){t||(t=!0,postMessage([r[0],0,e.toString()]))}try{$task.apply($task,[function(){var e;t||(t=!0,e=n.call(arguments),postMessage([r[0],1,e],e.filter($isTransferable)))},i].concat(r[1]))}catch(e){i(e)}},(i=new Worker(URL.createObjectURL(new Blob([r],{type:"application/javascript"})))).onmessage=function(t){var n=t.data[0],r=n?e[n]:null;n&&r&&(t.data[1]?r.resolve.apply(null,t.data[2]):r.reject(t.data[2]),delete e[n])},function(){var n=ee.defer(),r=S(),o=A(arguments);return e[r]=n,i.postMessage([r,o],o.filter(t)),n.pledge}}}(),oe=(Y=/^(?:\?|)$/,Z=new ie((function(e,t,n){var r,i,o=new XMLHttpRequest;r=function(){this.readyState<4&&this.abort()}.bind(o),o.ontimeout=o.onerror=o.onabort=function(){t(o.statusText)},o.onprogress=o.onreadystatechange=function(){self.clearTimeout(i),i=self.setTimeout(r,1e4)},o.onload=function(){i=self.clearTimeout(i),"status"in o&&200!==o.status?t(o.statusText):e(o.responseText,o.getResponseHeader&&o.getResponseHeader("content-type"))},o.open("GET",n,!0),o.send(),i=self.setTimeout(r,1e4)})),function(e){var t;function n(t,n){n&&e.handler.validate&&!e.handler.validate(n)?e.dfd.reject(new V("error loading (content-type)",e.id)):(e.source=t,O.emit("postRequest",e.type,e))}B.test(e.path)||P(c.pattern,(function(n,r){r.matches(e.path)&&(!t||t.weight<r.weight)&&(t=r)})),function r(i){i=i||0,e.url=a.createElement("a"),e.url.href=t?L(t.process(e.path,i)):e.path,e.invalid&&(e.url.search+=(Y.test(e.url.search)?"":"&")+D()),O.emit("preRequest",e.type,e),Z(e.url.href).then(n,(function(n){var o;i++,t&&t.location[i]?r(i):(o=n,e.dfd.reject(new V("error loading"+(o?" (status)":""),e.id)))}))}()});function ue(e){return Array.isArray(e)}function ae(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}r=function(){function t(e,t){this[e]={weight:e.length,state:t}}function n(e,t){"base"!==e&&(this[e]=new re(e,t))}function r(e,t){var n=this[e]=this[e]||{};O.emit("preConfigure",e,n),C(n,t),O.emit("postConfigure",e,n)}function i(){var t,n,r=A(arguments),i=this!==e?this:null,o=0;for(O.emit("preResolve",null,r,i);t=r[o];o++)x(t,"string")?r[o]=ne.resolve(t,i).pledge:(r[o]=(n=ee.defer()).pledge,n.resolve(t));return(r.length>1?ee.all(r):r[0]).always((function(){O.emit("postResolve",null,r,i)}))}return i.configure=function(e){var o=e.cache,u=e.version,a=e.delay,s=e.timeout,d=e.lifetime,f=e.base,l=e.pattern,h=e.modules,p=c.modules;return x(o,"boolean")?c.cache[""]={weight:0,state:o}:b(o)&&P(o,t,c.cache),R(u)&&(c.version=u),j(a)&&(c.delay=1e3*a),j(s)&&(c.timeout=1e3*Math.min(Math.max(s,2),20)),j(d)&&d>0&&(c.lifetime=1e3*d),x(f,"string")&&""!==f&&(c.pattern.base=new re("",f)),b(l)&&P(l,n,c.pattern),b(h)&&P(h,r,p),i},i.version="6.1.2",i.on=O.on.bind(i),i.get=function(e,t){var n=ne.get(e,t);return n&&n.value},i.list=ne.list,i.remove=ne.remove,i.cache={clear:Q.clear},O.after("cacheMiss",(function(e){new oe(e)})).after("postRequest",(function(e){var t=e.handler.onPostRequest;t&&t(e)})).after("cacheHit postRequest",(function(e){O.emit("preProcess",e.id,e)})).after("preRequest",(function(e){var t=e.handler.onPreRequest;t&&t(e)})).after("preProcess",(function(e){var t=e.handler.onPreProcess;t&&t(e),e.pledge.then((function(){O.emit("postProcess",e.id,e)})),!0===e.enqueue?o.enqueue(e):q(e.enqueue,ee)&&e.enqueue.then((function(){o.enqueue(e)}))})),i}(),e.defineProperty("demand",r),(i=function(){var t,n,i,o=x(arguments[0],"string")?arguments[0]:null,a=this!==e?this:null,s=ue(arguments[o?1:0])?arguments[o?1:0]:null,c=s?arguments[o?2:1]:arguments[o?1:0];if(!o&&u.current&&(o=(t=u.current).uri,u.process()),o)return t=t||new ne(o,a),n=q(c,ee),i=x(c,"function"),s?r.apply(t.path,s).then((function(){t.dfd.resolve(i?c.apply(null,arguments):c)}),(function(){t.dfd.reject(new V("error providing",t.id,arguments))})):n?c.then(t.dfd.resolve,t.dfd.reject):t.dfd.resolve(i?c():c),t.dfd.pledge.then((function(){O.emit("provide",t.path,t)}),(function(){O.emit("reject",t.path,t)})),t.dfd.pledge;throw new Error("unspecified anonymous provide")}).amd=!0,e.defineProperty("provide",i),r.configure({cache:!0,base:"/",pattern:{"/demand":L((s&&s.url||location.href)+"/../").slice(0,-1)}}),s&&s.settings&&r.configure(s.settings);var se=function(){var e=new $;function t(t){var n=this,i={queue:t,current:null};e.set(n,i),r.on("queueEnqueue:"+t.uuid,(function(){!i.current&&n.process()}))}return t.prototype={process:function(){var t,n=e.get(this);!n.queue.length||(t=n.current=n.queue.dequeue()).pledge.isRejected()?n.current=null:t.handler.process&&t.handler.process(t)},get current(){return e.get(this).current}},t}();function ce(e,t){for(var n,r;n=z.exec(t);)y.href=e,B.test(n[3])?r=y.protocol+"//"+y.host+n[3]:(y.pathname+=(_.test(y.pathname)?"/../":"/")+n[3],r=y.protocol+"//"+y.host+y.pathname),t=t.replace(n[0],n[1]+" "+n[2]+"="+r+".map"+(n[4]?" "+n[4]:""));return t}function de(){}de.prototype={validate:null,onPreRequest:null,onPostRequest:null,onPreProcess:null,process:null};var fe=function(){var e=a.getElementsByTagName("head")[0],t=/^(application|text)\/(x-)?javascript/,n={suffix:".js"};function i(){}return r.on("postConfigure:/demand/handler/module",(function(e){b(e)&&C(n,e)})),i.prototype={validate:function(e){return t.test(e)},onPreRequest:function(e,t){var r;(t="undefined"!=typeof t?t:n.suffix)&&0!==e.path.indexOf("@")&&(r=e.url.pathname,e.url.pathname=r.slice(-t.length)!==t?r+t:r)},onPostRequest:function(e){e.source=ce(e.url,e.source)},process:function(t){var n;t.source&&((n=a.createElement("script")).async=!0,n.text=t.source,n.setAttribute("demand-id",t.id),e.appendChild(n))}},new(i.extends(de))}();function V(e,t,n){return this.message=e,t&&(this.module=t),n&&(this.stack=A(n)),this}V.prototype={toString:function(){var e=this.message+" "+(this.module?'"'+this.module+'"':"");return this.stack&&(e=V.traverse(this.stack,e,1)),e}},V.traverse=function(e,t,n){for(var r,i=new Array(n+1).join(" "),o=0;r=e[o];o++)t+="\n"+i+"> "+r.message+" "+(r.module?'"'+r.module+'"':""),r.stack&&(t=V.traverse(r.stack,t,n+1));return t};var le=function(){var e={};function t(e,t){var n,r;for(n=0;r=t[n];n++)x(r,"string")&&(t[n]=J(r))}function n(){}return r.on("postConfigure:/demand/handler/bundle",(function(n){b(n)&&P(e=n,t)})),n.prototype={validate:fe.validate,onPreProcess:function(t){var n,r,i,u,a,s=t.source,c=t.dfd,d=e[t.path];function f(){c.reject(new V("error resolving",t.id,arguments))}if(t.enqueue=!1,d&&(n=function(t){for(var n,r,i=0;r=t[i];i++)if(r=(r=r.match(X))&&r[3]||e.handler,n){if(r!==n)return!1}else n=r;return n}(d))){for(;r=z.exec(s);)s=s.replace(r[0],"");for(t.source=s,i=[],a=0;u=d[a];a++)i.push(ne.resolve("mock:"+u).pledge);ee.all(i).then((function(){for(i.length=0,a=0;u=d[a];a++)(u=d[a]=ne.get(u)||new ne(u)).handler=arguments[a],i.push(u.pledge);"module"===n?(o.enqueue.apply(o,d),fe.process(t)):(fe.process(t),o.enqueue.apply(o,d)),ee.all(i).then(c.resolve,f)}),f)}else f()}},new(n.extends(de))}(),he=function(){var e=/^text\/.+$/,t={suffix:".html"};function n(){}return r.on("postConfigure:/demand/handler/component",(function(e){b(e)&&C(t,e)})),n.prototype={validate:function(t){return e.test(t)},onPreRequest:function(e,n){var r;(n="undefined"!=typeof n?n:t.suffix)&&(r=e.url.pathname,e.url.pathname=r.slice(-n.length)!==n?r+n:r)},onPostRequest:function(e){e.source=ce(e.url,e.source)},onPreProcess:function(e){var t,n,r,i,u=e.path,s=e.dfd,c=a.createElement("body"),d=[],f=[];function l(){s.reject(new V("error resolving",e.id,arguments))}for(e.enqueue=!1,c.innerHTML=e.source;t=c.firstElementChild;)(n=t.getAttribute("type"))&&(i=n+"!"+u+((r=t.getAttribute("path"))?"/"+r:""),t.parentNode.removeChild(t),d.push({source:t.textContent,uri:i}),f.push(ne.resolve("mock:"+i).pledge));ee.all(f).then((function(){var t,n,r,i=[];for(f.length=0,t=0;n=d[t];t++)(r=ne.get(n.uri)||new ne(n.uri)).source=ce(r.url,n.source),r.handler=arguments[t],i.push(r),f.push(r.pledge),o.enqueue(r);ee.all(f).then((function(){var r=e.path.length+1,o={};for(t=0;n=arguments[t];t++)o[i[t].path.substr(r)||"main"]=n;s.resolve(o)}),l)}),l)}},new(n.extends(de))}(),pe=function(){var e="/demand/plugin/genie",t=[];function n(e){for(var n,r,i=0;n=t[i];i++)n.prefix.test(e)&&(!r||n.weight>r.weight)&&(r=n);return r}function i(){for(var e,t=0;e=this[t];t++)e.dfd.resolve(arguments[t])}function o(){for(var e,t=0;e=this[t];t++)e.dfd.reject(new V("error resolving",e.id))}function u(e,n){t.push({prefix:new RegExp("^"+e),weight:e.length,fn:n})}function a(t,n){var u,a=n.matches,s=0;if(a.length>1){for(n.id=e+"/"+ae(JSON.stringify(n.matches));u=a[s];s++)a[s]=new ne(u.uri);r.configure(function(e){var t,n,r=e.matches,i={pattern:{},modules:{"/demand/handler/bundle":{}}},o=0;for(i.pattern[e.id]=e.fn(r),i.modules["/demand/handler/bundle"][e.id]=t=[];n=r[o];o++)t.push(n.path);return i}(n)),r("bundle!"+n.id).then(i.bind(a),o.bind(a))}}return r.on("postConfigure:"+e,(function(e){b(e)&&(t.length=0,P(e,u))})).on("preResolve",(function(e,t){for(var r,i,o={},u=0;r=e[u];u++)!x(r,"string")||W.test(r)||ne.get(r,t)||"module"===(r=new ne(r,t,!1)).type&&(i=n(r.path))&&!Q.get(r)&&(o[i.prefix]||(o[i.prefix]={fn:i.fn,matches:[]})).matches.push(r);P(o,a)})),!0}();function ve(e,t){i(e,(function(){return t}))}if(o=new H,u=new se(o),ve("/demand/abstract/uuid",I),ve("/demand/abstract/handler",de),ve("/demand/handler/module",fe),ve("/demand/handler/bundle",le),ve("/demand/handler/component",he),ve("/demand/plugin/genie",pe),ve("/demand/validator/isTypeOf",x),ve("/demand/validator/isArray",ue),ve("/demand/validator/isObject",b),ve("/demand/validator/isInstanceOf",q),ve("/demand/validator/isSemver",R),ve("/demand/function/resolveUrl",L),ve("/demand/function/resolveSourcemaps",ce),ve("/demand/function/merge",C),ve("/demand/function/iterate",P),ve("/demand/function/hash",ae),ve("/demand/function/defer",T),ve("/demand/function/idle",N),ve("/demand/function/uuid",S),ve("/demand/function/toArray",A),ve("/demand/task",ie),ve("/demand/weakmap",$),ve("/demand/descriptor",w),ve("/demand/pledge",ee),ve("/demand/queue",H),ve("/demand/failure",V),ve("/demand/semver",K),s&&s.main)switch(typeof s.main){case"string":r(s.main);break;case"function":i("main",s.main())}}("demand-loader"===this.name?parent:this,setTimeout,clearTimeout);
//# sourceMappingURL=demand.js.map
