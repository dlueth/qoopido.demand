/**! Qoopido.demand 6.0.1 | https://github.com/dlueth/qoopido.demand | (c) 2020 Dirk Lueth */
!function(e,t,n){"use strict";var r,i,o,u,a,c,s,l=e.document,f="demand"in e&&e.demand,d={version:"1.0.0",cache:{},timeout:8e3,pattern:{},modules:{},handler:"module"},h=(c=["info","warning","error"],s={warning:"warn"},function(e,t){var n=this;t={info:t&&t.info||"#95ba00",warning:t&&t.warning||"#f49d0c",error:t&&t.error||"#af0032"},c.forEach((function(r){n[r]=function(n){!function(e,t,n,r){"undefined"!=typeof console&&console[s[e]||e]("%c"+t+"%c"+n.toString(),"display:inline-block;padding:0.5em;line-height:1;font-weight:bold;color:#fff;background-color:"+r+";border-radius:3px;","display:inline-block;padding:0.5em;line-height:1;color:#666")}(r,e,n,t[r])}}))}),p=Array.prototype,v=p.slice,m=p.concat,g=Object,y=g.create,w=g.defineProperty,b=g.getOwnPropertyNames,x=g.getOwnPropertyDescriptor,j=l.createElement("a");function q(e,t,n,r){return{__proto__:null,value:e,enumerable:!!r,configurable:!!n,writable:!!t}}function k(e,t){return typeof e===t}function R(e){return e&&k(e,"object")}function P(e){return k(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function E(e,t){return e instanceof t}!function(t){function n(e,t,n,r,i){w(this,e,new q(t,n,r,i))}function r(e){for(var t,n=this.prototype,r=b(n),i={constructor:new q(this,!0,!0)},o=0;(t=r[o])&&!i[t];o++)i[t]=x(n,t);try{this.prototype=y(e.prototype||e,i)}catch(e){}if(this.prototype===n)throw new TypeError("Unable to extend, prototype is not writable");return this}n.call(Object.prototype,"define",n),n.call(e.Object.prototype,"define",n),Function.prototype.define("extends",r),e.Function.prototype.define("extends",r)}();var M,C=(M=/^\bv?(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)(?:-[\da-z-]+(?:\.[\da-z-]+)*)?(?:\+[\da-z-]+(?:\.[\da-z-]+)*)?\b$/i,function(e){return k(e,"string")&&M.test(e)});function S(e,t,n){for(var r,i=g.keys(e),o=0;void 0!==(r=i[o])&&!1!==t.call(n,r,e[r]);o++);return n}var T,A,O=function(){function e(e,t){var n,r=this[e];void 0!==t&&(R(t)?(n=R(r),r=void 0!==t.length?n&&void 0!==r.length?r:[]:n&&void 0===r.length?r:{},this[e]=O(r,t)):this[e]=t)}return function(){for(var t,n=arguments[0],r=1;void 0!==(t=arguments[r]);r++)S(t,e,n);return n}}(),$=function(){var e=new RegExp("[xy]","g");function t(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t)}}(),I="setImmediate"in e&&"function"==typeof e.setImmediate?e.setImmediate:"MutationObserver"in e&&"function"==typeof e.MutationObserver?(T={},A=l.createElement("div"),new MutationObserver((function(e){e.forEach((function(e){var t=e.attributeName.substr(1);T[t]&&T[t](),delete T[t]}))})).observe(A,{attributes:!0}),function(e){var t=$();T[t]=e,A.setAttribute("i"+t,1)}):t;function H(e,t,n){return v.call(e,t,n)}var N=function(){var e=/^cache(Miss|Hit|Clear|Exceed)|queue(En|De)queue|(pre|post)(Resolve|Configure|Request|Process|Cache)|provide|reject$/,t={};function n(n,r,i){var o,u;if(k(r,"string")&&k(i,"function"))for(r=r.split(" ");o=r.shift();)o=o.split(":"),e.test(o[0])&&((t[o[0]]||(t[o[0]]={on:[],after:[]}))[n].push({callback:i,filter:o[1]}),"on"===n&&"postConfigure"===o[0]&&(u=d.modules[o[1]])&&i(u))}function r(){}return r.prototype={emit:function(e,n){var r,i,o,u=t[e];if(u){for(r=H(arguments,2),i=0;o=u.on[i];i++)o.filter&&o.filter!==n||o.callback.apply(null,r);for(i=0;o=u.after[i];i++)o.filter&&o.filter!==n||o.callback.apply(null,r)}return this},on:function(e,t){return n("on",e,t),this},after:function(e,t){return n("after",e,t),this}},new r}(),D="WeakMap"in e&&!("ActiveXObject"in e)?e.WeakMap:function(){function e(e,t){var n;if((n=t[e.id])&&n[0]===t)return n}function t(){this.define("id","weakmap-"+$())}return t.prototype={set:function(t,n){var r=e(this,t);return r?r[1]=n:t.define(this.id,[t,n]),this},get:function(t){var n=e(this,t);if(n)return n[1]},delete:function(t){var n=e(this,t);n&&(n.length=0,delete t[this.id])},has:function(t){return!!e(this,t)}},t}();function L(){return k(this.uuid,"undefined")&&this.define("uuid",$()),this}var B=function(){var e=new D;function t(){var t=L.call(this);return e.set(t,[]),t}return t.prototype={enqueue:function(){var t=H(arguments);e.set(this,e.get(this).concat(t)),N.emit("queueEnqueue",this.uuid,t)},dequeue:function(){var t=e.get(this).shift();return N.emit("queueDequeue",this.uuid,t),t},get current(){return e.get(this)[0]},get length(){return e.get(this).length}},t.extends(L)}(),U=function(){var r,i="object"==typeof e.safari&&e.safari.pushNotification?"beforeunload":"visibilitychange",o=e.requestIdleCallback||function(e,n){var r=+new Date;return t((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(+new Date-r))}})}),n&&n.timeout)},u=e.cancelIdleCallback||function(e){n(e)},a=new B;function c(){a.dequeue()(),r=a.length&&o(c)}return e.addEventListener(i,(function(e){var t;if(a.length&&("visibilitychange"!==e.type||"hidden"===l.visibilityState)){r=u(r);do{t&&t()}while(t=a.dequeue())}}),!0),function(e,t){a.enqueue(e),!r&&a.length&&(r=o(c,{timeout:t}))}}();function z(){return+new Date}var _,F=(_=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,function(e){return e.replace(_,"\\$&")});function W(e){return j.href=e,j.href}var X=/^(http(s?):)?\/\//i,G=/^\//,J=/((?:\/\/|\/\*)#)\s*(sourceMappingURL)\s*=\s*(?!(?:http[s]?:)?\/\/)(.+?)\.map(?:\s+)?(\*\/)?/g,K=new RegExp("^"+F(W("/"))),Q=new RegExp("^demand|provide|path$"),V=/^(mock:)?([+-])?((?:[-\w]+\/?)+)?(?:@(.+?))?(?:#(\d+))?!/;function Y(e,t){var n=e.replace(V,"");return G.test(n)||X.test(n)||(n="/"+W((t&&W(t+"/../")||"/")+n).replace(K,"")),n}function Z(e,t){var n=e.match(V);return(n&&n[1]?"mock:":"")+(n&&n[3]||d.handler)+"!"+Y(e,t)}var ee=function(){function e(e,t){return e<t?-1:e>t?1:0}function t(e){if(!C(e))throw new TypeError('"version" must be a valid semver version string');e=function(e){var t,n=e.split("-"),r=0;for(n=n[1]?Array.prototype.concat(n[0].split("."),n[1].split(".")):n[0].split(".");t=n[r];r++)n[r]=parseInt(t,10).toString()===t?parseInt(t,10):t;return n}(e),this.major=e.shift(),this.minor=e.shift(),this.patch=e.shift(),this.identifier=e}return t.prototype={toString:function(){return this.major+"."+this.minor+"."+this.patch+(this.identifier.length?"-"+this.identifier.join("."):"")},compare:function(t){return e(this.major,t.major)||e(this.minor,t.minor)||e(this.patch,t.patch)||function(e,t){var n,r,i,o,u=0;if(e.length&&!t.length)return-1;if(!e.length&&t.length)return 1;if(!e.length&&!t.length)return 0;do{if(n=e[u],o=typeof(r=t[u]),"undefined"==(i=typeof n)&&"undefined"===o)return 0;if("undefined"===o)return 1;if("undefined"===i)return-1;if(n===r);else{if("string"===i&&"string"!==o)return 1;if("string"!==i&&"string"===o)return-1;if(n>r)return 1;if(n<r)return-1}}while(++u)}(this.identifier,t.identifier)}},t}(),te=function(){var t,n=new RegExp("^"+F("[demand]")+"\\[(.+?)\\]"+F("[state]")+"$"),i=/^(.+?),(\d+),(\d*),(.+?),(\d+)$/,o=function(){try{return"localStorage"in e&&e.localStorage}catch(e){return!1}}(),u=o?e.localStorage:null,a=o&&"remainingSpace"in u,c={};function s(e){var t;return null!==e.cache?e.cache:(S(d.cache,(function(n,r){0===e.path.indexOf(n)&&(!t||r.weight>t.weight)&&(t=r)})),!!t&&t.state)}function l(e){return u.getItem(e)}function f(e,t){u[t?"setItem":"removeItem"](e,t)}function h(e){var t,n=l(e);if(n&&(t=n.match(i)))return H(t,1)}function p(e,t){t[4]=z(),f(e,t.join(","))}function v(e,t,n){N.emit(e,t.id,t,n)}function m(){U(this.clear.expired.bind(this.clear),d.delay)}return N.on("cacheMiss",(function(e){U((function(){t.clear(e.id)}))})).on("cacheExceed",(function(e){r("-!/demand/cache/dispose").then((function(n){U((function(){n(e.source.length),t.set(e)}),d.delay)}))})).on("postRequest",(function(e){e.source&&s(e)&&(c[e.id]=!0)})).after("postProcess",(function(e){c[e.id]&&U((function(){t.set(e)}),d.delay)})),m.prototype={get:o?function(e){var t,n;if(s(e)){if(t="[demand]["+e.id+"]",!(n=h(t+"[state]")))return;return 1===e.version.compare(new ee(n[0]))||n[2]&&e.lifetime&&n[2]<=z()?void(e.invalid=!0):(e.source=l(t+"[value]"),U((function(){p(t+"[state]",n)}),d.delay),!0)}}:function(){},resolve:o?function(e){this.get(e)?v("cacheHit",e):v("cacheMiss",e)}:function(e){v("cacheMiss",e)},set:o?function(e){var t,n,i;if(s(e)){t=[e.version,e.source.length,e.lifetime?z()+e.lifetime:null,r.version],n="[demand]["+e.id+"]",v("preCache",e,t);try{if(i=a?u.remainingSpace:null,f(n+"[value]",e.source),p(n+"[state]",t),null!==i&&u.remainingSpace===i)throw new Error;v("postCache",e,t)}catch(t){v("cacheExceed",e)}}}:function(){},clear:o?function(e){var t=Z(e),n="[demand]["+t+"]";l(n+"[state]")&&(f(n+"[state]"),f(n+"[value]"),v("cacheClear",ae.get(t)||new ae(t,null,!1)))}:function(){}},m.prototype.clear.all=o?function(){var e;S(u,(function(t){(e=t.match(n))&&this(e[1])}),this)}:function(){},m.prototype.clear.expired=o?function(){var e,t;S(u,(function(r){(e=r.match(n))&&(t=h("[demand]["+e[1]+"][state]"))&&t[2]>0&&t[2]<=z()&&this(e[1])}),this)}:function(){},t=new m}(),ne=function(){var e=new D;function t(){e.get(this).handle("resolved",arguments)}function n(){e.get(this).handle("rejected",arguments)}function r(t,n){var r,i,o=e.get(this);for("pending"===o.state&&(o.state=t,o.value=n);r=o[o.state].shift();)try{if((i=r.handler.apply(null,o.value))&&"function"==typeof i.then){i.then(r.dfd.resolve,r.dfd.reject);continue}if("undefined"==typeof i){r.dfd["resolved"===o.state?"resolve":"reject"].apply(null,o.value);continue}r.dfd.resolve(i)}catch(e){r.dfd.reject(e)}o.resolved.length=0,o.rejected.length=0}function i(e,t,n){e.then((function(){n.resolved[t]=H(arguments),n.count++,o(n)}),(function(){n.rejected.push(H(arguments)),o(n)}))}function o(e){e.count===e.total?e.dfd.resolve.apply(null,m.apply([],e.resolved)):e.rejected.length+e.count===e.total&&e.dfd.reject.apply(null,m.apply([],e.rejected))}function u(i){return e.set(this,{state:"pending",handle:r.bind(this),value:null,resolved:[],rejected:[],count:0}),i(t.bind(this),n.bind(this)),this}return u.prototype={catch:function(e){return this.then(void 0,(function(){var t,n=u.defer();try{(t=e.apply(null,arguments))&&"function"==typeof t.then?t.then(n.resolve,n.reject):n.resolve(t)}catch(e){n.reject(e)}return n.pledge}))},always:function(e){return this.then(e,(function(){var t,n=u.defer();try{(t=e.apply(null,arguments))&&"function"==typeof t.then?t.then(n.resolve,n.reject):n.reject.apply(null,arguments)}catch(e){n.reject(e)}return n.pledge}))},then:function(t,n){var r=e.get(this),i=u.defer();return r.resolved.push({handler:t||function(){return u.resolve.apply(null,arguments)},dfd:i}),r.rejected.push({handler:n||function(){return u.reject.apply(null,arguments)},dfd:i}),"pending"!==r.state&&I(r.handle),i.pledge},isPending:function(){return"pending"===e.get(this).state},isResolved:function(){return"resolved"===e.get(this).state},isRejected:function(){return"rejected"===e.get(this).state}},u.prototype.finally=u.prototype.always,u.defer=function(){var e={};return e.pledge=new u((function(t,n){e.resolve=t,e.reject=n})),e},u.all=function(e){var t,n,r=u.defer(),o=0;if(e.length)for(t={dfd:r,resolved:[],rejected:[],total:e.length,count:0};n=e[o];o++)i(n,o,t);else r.resolve();return r.pledge},u.race=function(e){for(var t,n=u.defer(),r=0;t=e[r];r++)t.then(n.resolve,n.reject);return e.length||n.resolve(),n.pledge},u.resolve=function(){var e=u.defer();return e.resolve.apply(null,arguments),e.pledge},u.reject=function(){var e=u.defer();return e.reject.apply(null,arguments),e.pledge},u}(),re=function(){var e=new D;function t(){e.set(this,{})}return t.prototype={get:function(t){return t?e.get(this)[t]:e.get(this)},set:function(t,n){e.get(this)[t]=n},remove:function(t){delete e.get(this)[t]}},t}();function ie(e,t,n){return this.message=e,t&&(this.module=t),n&&(this.stack=H(n)),this}ie.prototype={toString:function(){var e=this.message+" "+(this.module?'"'+this.module+'"':"");return this.stack&&(e=ie.traverse(this.stack,e,1)),e}},ie.traverse=function(e,t,n){for(var r,i=new Array(n+1).join(" "),o=0;r=e[o];o++)t+="\n"+i+"> "+r.message+" "+(r.module?'"'+r.module+'"':""),r.stack&&(t=ie.traverse(r.stack,t,n+1));return t};var oe,ue,ae=function(){var e=new re,t=/^(?:mock:|internal!)/i,n=[];function o(e,t){this[e]=t}function u(e){t.test(e)||this.push(e)}function a(e,n){!t.test(e)&&n.pledge.isPending()&&this.push(e)}function c(e,n){!t.test(e)&&n.pledge.isResolved()&&this.push(e)}function s(e,n){!t.test(e)&&n.pledge.isRejected()&&this.push(e)}function f(){return S(e.get(),u,[])}function h(t,r,i){var o=this,u=t.match(V)||n;return o.path=Y(t,r),o.mock=!!u[1],o.cache=u[2]?"+"===u[1]:null,o.type=u[3]||d.handler,o.version=new ee(u[4]||d.version),o.lifetime=u[5]&&1e3*u[5]||d.lifetime,o.id=(o.mock?"mock:":"")+o.type+"!"+o.path,o.uri=(o.mock?"mock:":"")+o.type+"@"+o.version+(P(o.lifetime)&&o.lifetime>0?"#"+o.lifetime:"")+"!"+o.path,o.dfd=ne.defer(),o.pledge=o.dfd.pledge,o.invalid=!1,o.pledge.then((function(){o.value=H(arguments)})),!1!==i&&e.set(o.id,o),o}return f.pending=function(){return S(e.get(),a,[])},f.resolved=function(){return S(e.get(),c,[])},f.rejected=function(){return S(e.get(),s,[])},h.prototype={enqueue:!0},h.get=function(t,n){return e.get(Z(t,n))},h.resolve=function(e,t){var n,u=t&&Q.test(e),a=u?this.get("internal!"+t+"/"+e):this.get(e,t);if(!a)if(u){switch(a=new h("internal!"+t+"/"+e),e){case"demand":n=S(r,o,r.bind(t));break;case"provide":n=i.bind(t);break;case"path":n=t}a.dfd.resolve(n)}else a=new h(e,t),r("/demand/handler/"+a.type).then((function(e){a.handler=e,a.mock?a.dfd.resolve(e):te.resolve(a)}),(function(){a.dfd.reject(new ie("error loading (handler)",self.id))}));return a},h.remove=function(t,n,r){var i=Z(t,n),o=l.querySelector('[demand-id="'+i+'"]');e.remove(i),e.remove("mock:"+i),o&&o.parentNode.removeChild(o),!1!==r&&te.clear(i)},h.list=f,h}(),ce=function(){var e=/(.+)\/$/;function t(t,n){this[t]={url:W(n).replace(e,"$1"),match:new RegExp("^"+F(n))}}function n(e,n){this.weight=e.length,this.match=new RegExp("^"+F(e)),this.location=[].concat(n),S(this.location,t,this.location)}return n.prototype={matches:function(e){return this.match.test(e)},process:function(e,t){var n=this.location[t];if(n)return e.replace(this.match,n.url)}},n}(),se=function(){var e={};function t(e){return e instanceof ArrayBuffer||e instanceof MessagePort||"ImageBitmap"in self&&e instanceof ImageBitmap}return function(n){var r,i;return r="$task = "+n+"; $isTransferable = "+t+"; onmessage = "+function(e){var t,n=Array.prototype.slice,r=e.data;function i(e){t||(t=!0,postMessage([r[0],0,e.toString()]))}try{$task.apply($task,[function(){var e;t||(t=!0,e=n.call(arguments),postMessage([r[0],1,e],e.filter($isTransferable)))},i].concat(r[1]))}catch(e){i(e)}},(i=new Worker(URL.createObjectURL(new Blob([r],{type:"application/javascript"})))).onmessage=function(t){var n=t.data[0],r=n?e[n]:null;n&&r&&(t.data[1]?r.resolve.apply(null,t.data[2]):r.reject(t.data[2]),delete e[n])},function(){var n=ne.defer(),r=$(),o=H(arguments);return e[r]=n,i.postMessage([r,o],o.filter(t)),n.pledge}}}(),le=(oe=/^(?:\?|)$/,ue=new se((function(e,t,n){var r,i,o=new XMLHttpRequest;r=function(){this.readyState<4&&this.abort()}.bind(o),o.ontimeout=o.onerror=o.onabort=function(){t(o.statusText)},o.onprogress=o.onreadystatechange=function(){self.clearTimeout(i),i=self.setTimeout(r,1e4)},o.onload=function(){i=self.clearTimeout(i),"status"in o&&200!==o.status?t(o.statusText):e(o.responseText,o.getResponseHeader&&o.getResponseHeader("content-type"))},o.open("GET",n,!0),o.send(),i=self.setTimeout(r,1e4)})),function(e){var t;function n(t,n){n&&e.handler.validate&&!e.handler.validate(n)?e.dfd.reject(new ie("error loading (content-type)",e.id)):(e.source=t,N.emit("postRequest",e.type,e))}X.test(e.path)||S(d.pattern,(function(n,r){r.matches(e.path)&&(!t||t.weight<r.weight)&&(t=r)})),function r(i){i=i||0,e.url=l.createElement("a"),e.url.href=t?W(t.process(e.path,i)):e.path,e.invalid&&(e.url.search+=(oe.test(e.url.search)?"":"&")+z()),N.emit("preRequest",e.type,e),ue(e.url.href).then(n,(function(n){var o;i++,t&&t.location[i]?r(i):(o=n,e.dfd.reject(new ie("error loading"+(o?" (status)":""),e.id)))}))}()});function fe(e){return Array.isArray(e)}function de(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}r=function(){function t(e,t){this[e]={weight:e.length,state:t}}function n(e,t){"base"!==e&&(this[e]=new ce(e,t))}function r(e,t){var n=this[e]=this[e]||{};N.emit("preConfigure",e,n),O(n,t),N.emit("postConfigure",e,n)}function i(){var t,n,r=H(arguments),i=this!==e?this:null,o=0;for(N.emit("preResolve",null,r,i);t=r[o];o++)k(t,"string")?r[o]=ae.resolve(t,i).pledge:(r[o]=(n=ne.defer()).pledge,n.resolve(t));return(r.length>1?ne.all(r):r[0]).always((function(){N.emit("postResolve",null,r,i)}))}return i.configure=function(e){var o=e.cache,u=e.version,a=e.delay,c=e.timeout,s=e.lifetime,l=e.base,f=e.pattern,h=e.modules,p=d.modules;return k(o,"boolean")?d.cache[""]={weight:0,state:o}:R(o)&&S(o,t,d.cache),C(u)&&(d.version=u),P(a)&&(d.delay=1e3*a),P(c)&&(d.timeout=1e3*Math.min(Math.max(c,2),20)),P(s)&&s>0&&(d.lifetime=1e3*s),k(l,"string")&&""!==l&&(d.pattern.base=new ce("",l)),R(f)&&S(f,n,d.pattern),R(h)&&S(h,r,p),i},i.version="6.0.1",i.on=N.on.bind(i),i.get=function(e,t){var n=ae.get(e,t);return n&&n.value},i.list=ae.list,i.remove=ae.remove,i.cache={clear:te.clear},N.after("cacheMiss",(function(e){new le(e)})).after("postRequest",(function(e){var t=e.handler.onPostRequest;t&&t(e)})).after("cacheHit postRequest",(function(e){N.emit("preProcess",e.id,e)})).after("preRequest",(function(e){var t=e.handler.onPreRequest;t&&t(e)})).after("preProcess",(function(e){var t=e.handler.onPreProcess;t&&t(e),e.pledge.then((function(){N.emit("postProcess",e.id,e)})),!0===e.enqueue?o.enqueue(e):E(e.enqueue,ne)&&e.enqueue.then((function(){o.enqueue(e)}))})),i}(),e.define("demand",r),i=function(){var t,n,i,o=k(arguments[0],"string")?arguments[0]:null,c=this!==e?this:null,s=fe(arguments[o?1:0])?arguments[o?1:0]:null,l=s?arguments[o?2:1]:arguments[o?1:0];if(!o&&u.current&&(o=(t=u.current).uri,u.process()),o)return t=t||new ae(o,c),n=E(l,ne),i=k(l,"function"),s?r.apply(t.path,s).then((function(){t.dfd.resolve(i?l.apply(null,arguments):l)}),(function(){t.dfd.reject(new ie("error providing",t.id,arguments))})):n?l.then(t.dfd.resolve,t.dfd.reject):t.dfd.resolve(i?l():l),t.dfd.pledge.then((function(){N.emit("provide",t.path,t)}),(function(){N.emit("reject",t.path,t)})),t.dfd.pledge;a.error(new ie("unspecified anonymous provide"))},e.define("provide",i),a=new h("qoopido.demand"),r.configure({cache:!0,base:"/",pattern:{"/demand":W((f&&f.url||location.href)+"/../").slice(0,-1)}}),f&&f.settings&&r.configure(f.settings);var he=function(){var e=new D;function t(t){var n=this,i={queue:t,current:null};e.set(n,i),r.on("queueEnqueue:"+t.uuid,(function(){!i.current&&n.process()}))}return t.prototype={process:function(){var t,n=e.get(this);!n.queue.length||(t=n.current=n.queue.dequeue()).pledge.isRejected()?n.current=null:t.handler.process&&t.handler.process(t)},get current(){return e.get(this).current}},t}();function pe(e,t){for(var n,r;n=J.exec(t);)j.href=e,X.test(n[2])?r=j.protocol+"//"+j.host+n[3]:(j.pathname+="/../"+n[3],r=j.protocol+"//"+j.host+j.pathname),t=t.replace(n[0],n[1]+" "+n[2]+"="+r+".map"+(n[4]?" "+n[4]:""));return t}function ve(){}ve.prototype={validate:null,onPreRequest:null,onPostRequest:null,onPreProcess:null,process:null};var me=function(){var e=l.getElementsByTagName("head")[0],t=/^(application|text)\/(x-)?javascript/,n={suffix:".js"};function i(){}return r.on("postConfigure:/demand/handler/module",(function(e){R(e)&&O(n,e)})),i.prototype={validate:function(e){return t.test(e)},onPreRequest:function(e,t){var r;(t="undefined"!=typeof t?t:n.suffix)&&(r=e.url.pathname,e.url.pathname=r.slice(-t.length)!==t?r+t:r)},onPostRequest:function(e){e.source=pe(e.url,e.source)},process:function(t){var n;t.source&&((n=l.createElement("script")).async=!0,n.text=t.source,n.setAttribute("demand-id",t.id),e.appendChild(n))}},new(i.extends(ve))}();function ie(e,t,n){return this.message=e,t&&(this.module=t),n&&(this.stack=H(n)),this}ie.prototype={toString:function(){var e=this.message+" "+(this.module?'"'+this.module+'"':"");return this.stack&&(e=ie.traverse(this.stack,e,1)),e}},ie.traverse=function(e,t,n){for(var r,i=new Array(n+1).join(" "),o=0;r=e[o];o++)t+="\n"+i+"> "+r.message+" "+(r.module?'"'+r.module+'"':""),r.stack&&(t=ie.traverse(r.stack,t,n+1));return t};var ge=function(){var e={};function t(e,t){var n,r;for(n=0;r=t[n];n++)k(r,"string")&&(t[n]=Z(r))}function n(){}return r.on("postConfigure:/demand/handler/bundle",(function(n){R(n)&&S(e=n,t)})),n.prototype={validate:me.validate,onPreProcess:function(t){var n,r,i,u,a,c=t.source,s=t.dfd,l=e[t.path];function f(){s.reject(new ie("error resolving",t.id,arguments))}if(t.enqueue=!1,l&&(n=function(t){for(var n,r,i=0;r=t[i];i++)if(r=(r=r.match(V))&&r[3]||e.handler,n){if(r!==n)return!1}else n=r;return n}(l))){for(;r=J.exec(c);)c=c.replace(r[0],"");for(t.source=c,i=[],a=0;u=l[a];a++)i.push(ae.resolve("mock:"+u).pledge);ne.all(i).then((function(){for(i.length=0,a=0;u=l[a];a++)(u=l[a]=ae.get(u)||new ae(u)).handler=arguments[a],i.push(u.pledge);"module"===n?(o.enqueue.apply(o,l),me.process(t)):(me.process(t),o.enqueue.apply(o,l)),ne.all(i).then(s.resolve,f)}),f)}else f()}},new(n.extends(ve))}(),ye=function(){var e=/^text\/.+$/,t={suffix:".html"};function n(){}return r.on("postConfigure:/demand/handler/component",(function(e){R(e)&&O(t,e)})),n.prototype={validate:function(t){return e.test(t)},onPreRequest:function(e,n){var r;(n="undefined"!=typeof n?n:t.suffix)&&(r=e.url.pathname,e.url.pathname=r.slice(-n.length)!==n?r+n:r)},onPostRequest:function(e){e.source=pe(e.url,e.source)},onPreProcess:function(e){var t,n,r,i,u=e.path,a=e.dfd,c=l.createElement("body"),s=[],f=[];function d(){a.reject(new ie("error resolving",e.id,arguments))}for(e.enqueue=!1,c.innerHTML=e.source;t=c.firstElementChild;)(n=t.getAttribute("type"))&&(i=n+"!"+u+((r=t.getAttribute("path"))?"/"+r:""),t.parentNode.removeChild(t),s.push({source:t.textContent,uri:i}),f.push(ae.resolve("mock:"+i).pledge));ne.all(f).then((function(){var t,n,r,i=[];for(f.length=0,t=0;n=s[t];t++)(r=ae.get(n.uri)||new ae(n.uri)).source=pe(r.url,n.source),r.handler=arguments[t],i.push(r),f.push(r.pledge),o.enqueue(r);ne.all(f).then((function(){var r=e.path.length+1,o={};for(t=0;n=arguments[t];t++)o[i[t].path.substr(r)||"main"]=n;a.resolve(o)}),d)}),d)}},new(n.extends(ve))}(),we=function(){var e="/demand/plugin/genie",t=[];function n(e){for(var n,r,i=0;n=t[i];i++)0===e.indexOf(n.prefix)&&(!r||n.weight>r.weight)&&(r=n);return r}function i(){for(var e,t=0;e=this[t];t++)e.dfd.resolve(arguments[t])}function o(){for(var e,t=0;e=this[t];t++)e.dfd.reject(new ie("error resolving",e.id))}function u(e,n){t.push({prefix:e,weight:e.length,fn:n})}function a(t,n){var u,a=n.matches,c=0;if(a.length>1){for(n.id=e+"/"+de(JSON.stringify(n.matches));u=a[c];c++)a[c]=new ae(u.uri);r.configure(function(e){var t,n,r=e.matches,i={pattern:{},modules:{"/demand/handler/bundle":{}}},o=0;for(i.pattern[e.id]=e.fn(r),i.modules["/demand/handler/bundle"][e.id]=t=[];n=r[o];o++)t.push(n.path);return i}(n)),r("bundle!"+n.id).then(i.bind(a),o.bind(a))}}return r.on("postConfigure:"+e,(function(e){R(e)&&(t.length=0,S(e,u))})).on("preResolve",(function(e,t){for(var r,i,o={},u=0;r=e[u];u++)!k(r,"string")||Q.test(r)||ae.get(r,t)||"module"===(r=new ae(r,t,!1)).type&&(i=n(r.path))&&!te.get(r)&&(o[i.prefix]||(o[i.prefix]={fn:i.fn,matches:[]})).matches.push(r);S(o,a)})),!0}();function be(e,t){i(e,(function(){return t}))}if(o=new B,u=new he(o),be("/demand/abstract/uuid",L),be("/demand/abstract/handler",ve),be("/demand/handler/module",me),be("/demand/handler/bundle",ge),be("/demand/handler/component",ye),be("/demand/plugin/genie",we),be("/demand/validator/isTypeOf",k),be("/demand/validator/isArray",fe),be("/demand/validator/isObject",R),be("/demand/validator/isInstanceOf",E),be("/demand/validator/isSemver",C),be("/demand/function/resolveUrl",W),be("/demand/function/resolveSourcemaps",pe),be("/demand/function/merge",O),be("/demand/function/iterate",S),be("/demand/function/hash",de),be("/demand/function/defer",I),be("/demand/function/idle",U),be("/demand/function/uuid",$),be("/demand/function/toArray",H),be("/demand/logger",h),be("/demand/task",se),be("/demand/weakmap",D),be("/demand/descriptor",q),be("/demand/pledge",ne),be("/demand/queue",B),be("/demand/failure",ie),be("/demand/semver",ee),f&&f.main)switch(typeof f.main){case"string":r(f.main);break;case"function":i("main",f.main())}}("demand-loader"===this.name?parent:this,setTimeout,clearTimeout);
//# sourceMappingURL=demand.js.map
