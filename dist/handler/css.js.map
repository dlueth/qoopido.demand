{"version":3,"sources":["handler/css.js"],"names":["document","definition","abstractHandler","functionResolveSourcemaps","resolveUrl","url","resolver","href","replaceUri","source","match","replacement","regexIsAbsoluteUri","test","replace","HandlerCss","suffix","target","getElementsByTagName","createElement","regexMatchUrl","regexMatchImport","regexIsAbsolutePath","regexMatchType","prototype","validate","type","onPreRequest","dependency","pathname","slice","length","onPostRequest","base","host","exec","process","element","querySelector","id","setAttribute","appendChild","tagName","styleSheet","cssText","textContent","provide","extends"],"mappings":";CAAC,SAASA,GACT,YAEA,SAASC,GAAWC,EAAiBC,GAUpC,QAASC,GAAWC,GAGnB,MAFAC,GAASC,KAAOF,EAETC,EAGR,QAASE,GAAWC,EAAQC,EAAOC,GAKlC,MAJIC,GAAmBC,KAAKH,EAAM,MACjCD,EAASA,EAAOK,QAAQJ,EAAM,GAAIC,IAG5BF,EAGR,QAASM,MAvBT,GAAIC,GAAsB,OACzBC,EAAsBjB,EAASkB,qBAAqB,QAAQ,GAC5DZ,EAAsBN,EAASmB,cAAc,KAC7CC,EAAsB,oCACtBC,EAAsB,4BACtBC,EAAsB,OACtBV,EAAsB,yBACtBW,EAAsB,YAmEvB,OAjDAR,GAAWS,WACVC,SAAU,SAASC,GAClB,MAAOH,GAAeV,KAAKa,IAE5BC,aAAc,SAASC,GACtB,GAAIC,GAAWD,EAAWvB,IAAIwB,QAE9BD,GAAWvB,IAAIwB,SAAWA,EAASC,OAAOd,EAAOe,UAAYf,EAASa,EAAWb,EAASa,GAE3FG,cAAe,SAASJ,GAOvB,IANA,GAIClB,GAJGL,EAAUD,EAAWwB,EAAWvB,IAAM,OACzC4B,EAAU5B,EAAIE,KACd2B,EAAU,KAAO7B,EAAI6B,KACrBzB,EAAUmB,EAAWnB,OAGfC,EAAQU,EAAce,KAAK1B,IACjCA,EAASD,EAAWC,EAAQC,EAAO,QAAUN,EAAWkB,EAAoBT,KAAKH,EAAM,IAAMwB,EAAOxB,EAAM,GAAKuB,EAAOvB,EAAM,IAAIH,KAAO,KAGxI,MAAOG,EAAQW,EAAiBc,KAAK1B,IACpCA,EAASD,EAAWC,EAAQC,EAAO,YAAcN,EAAWkB,EAAoBT,KAAKH,EAAM,IAAMwB,EAAOxB,EAAM,GAAKuB,EAAOvB,EAAM,IAAIH,KAAO,IAG5IqB,GAAWnB,OAASN,EAA0ByB,EAAWvB,IAAKI,IAE/D2B,QAAS,SAASR,GACjB,GAAIS,GAAUrC,EAASsC,cAAc,eAAiBV,EAAWW,GAAK,KAElEF,KACHA,EAAerC,EAASmB,cAAc,SACtCkB,EAAQX,KAAO,WAEfW,EAAQG,aAAa,YAAaZ,EAAWW,IAC7CtB,EAAOwB,YAAYJ,IAGG,UAApBA,EAAQK,UACPL,EAAQM,WACVN,EAAQM,WAAWC,QAAUhB,EAAWnB,OAExC4B,EAAQQ,YAAcjB,EAAWnB,QAInCqC,QAAQ,WAAa,MAAOT,OAIvB,IAAKtB,EAAWgC,QAAQ7C,IAGhC4C,SAAU,2BAA4B,sCAAwC7C,IAC7ED","file":"css.js","sourcesContent":["(function(document) {\n\t'use strict';\n\n\tfunction definition(abstractHandler, functionResolveSourcemaps) {\n\t\tvar suffix              = '.css',\n\t\t\ttarget              = document.getElementsByTagName('head')[0],\n\t\t\tresolver            = document.createElement('a'),\n\t\t\tregexMatchUrl       = /url\\s*\\(\\s*[\"']?(.+?)[\"']?\\s*\\)/gi,\n\t\t\tregexMatchImport    = /@import\\s+[\"'](.+?)[\"']/gi,\n\t\t\tregexIsAbsolutePath = /^\\//i,\n\t\t\tregexIsAbsoluteUri  = /^data:|http(s?):|\\/\\//i,\n\t\t\tregexMatchType      = /^text\\/css/;\n\n\t\tfunction resolveUrl(url) {\n\t\t\tresolver.href = url;\n\n\t\t\treturn resolver;\n\t\t}\n\n\t\tfunction replaceUri(source, match, replacement) {\n\t\t\tif(!regexIsAbsoluteUri.test(match[1])) {\n\t\t\t\tsource = source.replace(match[0], replacement);\n\t\t\t}\n\n\t\t\treturn source;\n\t\t}\n\n\t\tfunction HandlerCss() {}\n\n\t\tHandlerCss.prototype = {\n\t\t\tvalidate: function(type) {\n\t\t\t\treturn regexMatchType.test(type);\n\t\t\t},\n\t\t\tonPreRequest: function(dependency) {\n\t\t\t\tvar pathname = dependency.url.pathname;\n\t\t\t\t\n\t\t\t\tdependency.url.pathname = pathname.slice(-suffix.length) !== suffix ? pathname + suffix : pathname;\n\t\t\t},\n\t\t\tonPostRequest: function(dependency) {\n\t\t\t\tvar url     = resolveUrl(dependency.url + '/..'),\n\t\t\t\t\tbase    = url.href,\n\t\t\t\t\thost    = '//' + url.host,\n\t\t\t\t\tsource  = dependency.source,\n\t\t\t\t\tmatch;\n\n\t\t\t\twhile((match = regexMatchUrl.exec(source))) {\n\t\t\t\t\tsource = replaceUri(source, match, 'url(\"' + resolveUrl(regexIsAbsolutePath.test(match[1]) ? host + match[1] : base + match[1]).href + '\")');\n\t\t\t\t}\n\n\t\t\t\twhile((match = regexMatchImport.exec(source))) {\n\t\t\t\t\tsource = replaceUri(source, match, '@import \"' + resolveUrl(regexIsAbsolutePath.test(match[1]) ? host + match[1] : base + match[1]).href + '\"');\n\t\t\t\t}\n\n\t\t\t\tdependency.source = functionResolveSourcemaps(dependency.url, source);\n\t\t\t},\n\t\t\tprocess: function(dependency) {\n\t\t\t\tvar element = document.querySelector('[demand-id=\"' + dependency.id + '\"]');\n\n\t\t\t\tif(!element) {\n\t\t\t\t\telement      = document.createElement('style');\n\t\t\t\t\telement.type = 'text/css';\n\n\t\t\t\t\telement.setAttribute('demand-id', dependency.id);\n\t\t\t\t\ttarget.appendChild(element);\n\t\t\t\t}\n\n\t\t\t\tif(element.tagName === 'STYLE') {\n\t\t\t\t\tif(element.styleSheet) {\n\t\t\t\t\t\telement.styleSheet.cssText = dependency.source;\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.textContent = dependency.source;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tprovide(function() { return element; });\n\t\t\t}\n\t\t};\n\n\t\treturn new (HandlerCss.extends(abstractHandler));\n\t}\n\n\tprovide([ '/demand/abstract/handler', '/demand/function/resolveSourcemaps' ], definition);\n}(document));"]}