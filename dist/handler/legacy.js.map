{"version":3,"sources":["handler/legacy.js"],"names":["provide","path","Failure","Pledge","handlerModule","isObject","merge","onAnimationFrame","settings","suffix","resolve","result","self","this","dfd","probe","process","reject","HandlerLegacy","demand","on","options","prototype","onPreRequest","dependency","dependencies","enqueue","apply","then","onPreProcess","bind","idle","boundResolve","arguments","extends"],"mappings":";CAAC,WACA,aA4EAA,QAAQ,CAAE,OAAQ,kBAAmB,iBAAkB,yBAA0B,6BAA8B,yBAA0B,sCA1EzI,SAAoBC,EAAMC,EAASC,EAAQC,EAAeC,EAAUC,EAAOC,GAC1E,IAAIC,EAAW,CAAEC,OAAQ,OASzB,SAASC,IACR,IAGCC,EAHGC,EAAQC,KACXC,EAAQF,EAAKE,IACbC,EAAQP,EAASI,EAAKX,OAASO,EAASI,EAAKX,MAAMc,MAGpDX,EAAcY,QAAQJ,GAEnBG,IAAUJ,EAASI,KACrBf,SAAQ,WAAa,OAAOW,KAEzBI,EACFD,EAAIG,OAAO,IAAIf,EAAQ,gBAAiBU,EAAKX,OAE7CD,SAAQ,WAAa,OAAO,KAK/B,SAASkB,KA0CT,OApEAC,OACEC,GAAG,iBAAmBnB,GAAM,SAASoB,GAClChB,EAASgB,IACXf,EAAME,EAAUa,MAyBnBH,EAAcI,UAAY,CACzBC,aAAc,SAASC,EAAYf,GAClC,IAAIgB,EAAejB,EAASgB,EAAWvB,OAASO,EAASgB,EAAWvB,MAAMwB,aAE1EhB,EAA4B,oBAAXA,EAA0BA,EAASD,EAASC,OAE7DL,EAAcmB,aAAaC,EAAYf,IAAU,GAE9CgB,IACFD,EAAWE,QAAUP,OAAOQ,MAAM,KAAMF,GAAcG,OAGxDC,aAAc,SAASL,GACtB,IAAIC,EAAejB,EAASgB,EAAWvB,OAASO,EAASgB,EAAWvB,MAAMwB,aAEvEA,GAA8C,kBAAvBD,EAAWE,UACpCF,EAAWE,QAAUP,OACnBQ,MAAM,KAAMF,GACZG,MAAK,WACL,OAAO,IAAIzB,EAAOI,EAAiBuB,KAAK,KAAMX,OAAOY,YAIzDf,QAAS,SAASQ,GACjB,IAAIQ,EAAetB,EAAQoB,KAAKN,IAEN,IAAvBA,EAAWE,QACbM,IAEAR,EAAWE,QACTE,KACAI,GACA,WACCR,EAAWV,IAAIG,OAAO,IAAIf,EAAQ,kBAAmBsB,EAAWvB,KAAMgC,iBAOrE,IAAKf,EAAcgB,QAAQ9B,OA1EpC","file":"legacy.js","sourcesContent":["(function() {\n\t'use strict';\n\n\tfunction definition(path, Failure, Pledge, handlerModule, isObject, merge, onAnimationFrame) {\n\t\tvar settings = { suffix: '.js' };\n\n\t\tdemand\n\t\t\t.on('postConfigure:' + path, function(options) {\n\t\t\t\tif(isObject(options)) {\n\t\t\t\t\tmerge(settings, options);\n\t\t\t\t}\n\t\t\t});\n\n\t\tfunction resolve() {\n\t\t\tvar self  = this,\n\t\t\t\tdfd   = self.dfd,\n\t\t\t\tprobe = settings[self.path] && settings[self.path].probe,\n\t\t\t\tresult;\n\n\t\t\thandlerModule.process(self);\n\n\t\t\tif(probe && (result = probe())) {\n\t\t\t\tprovide(function() { return result; });\n\t\t\t} else {\n\t\t\t\tif(probe) {\n\t\t\t\t\tdfd.reject(new Failure('error probing', self.path));\n\t\t\t\t} else {\n\t\t\t\t\tprovide(function() { return true; });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction HandlerLegacy() {}\n\n\t\tHandlerLegacy.prototype = {\n\t\t\tonPreRequest: function(dependency, suffix) {\n\t\t\t\tvar dependencies = settings[dependency.path] && settings[dependency.path].dependencies;\n\n\t\t\t\tsuffix = (typeof suffix !== 'undefined') ? suffix : settings.suffix;\n\n\t\t\t\thandlerModule.onPreRequest(dependency, suffix || false);\n\n\t\t\t\tif(dependencies) {\n\t\t\t\t\tdependency.enqueue = demand.apply(null, dependencies).then;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonPreProcess: function(dependency) {\n\t\t\t\tvar dependencies = settings[dependency.path] && settings[dependency.path].dependencies;\n\n\t\t\t\tif(dependencies && typeof dependency.enqueue === 'boolean') {\n\t\t\t\t\tdependency.enqueue = demand\n\t\t\t\t\t\t.apply(null, dependencies)\n\t\t\t\t\t\t.then(function() {\n\t\t\t\t\t\t\treturn new Pledge(onAnimationFrame.bind(null, demand.idle));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tprocess: function(dependency) {\n\t\t\t\tvar boundResolve = resolve.bind(dependency);\n\n\t\t\t\tif(dependency.enqueue === true) {\n\t\t\t\t\tboundResolve();\n\t\t\t\t} else {\n\t\t\t\t\tdependency.enqueue\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tboundResolve,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tdependency.dfd.reject(new Failure('error resolving', dependency.path, arguments));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn new (HandlerLegacy.extends(handlerModule));\n\t}\n\n\tprovide([ 'path', '/demand/failure', '/demand/pledge', '/demand/handler/module', '/demand/validator/isObject', '/demand/function/merge', '/demand/function/onAnimationFrame' ], definition);\n}());\n"]}